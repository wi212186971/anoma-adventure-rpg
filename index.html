<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anoma RPG - æ„å›¾ä¹‹å¢ƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #ffd700;
        }

        .game-title {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .game-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        .sidebar {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #444;
        }

        .main-content {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #444;
        }

        .player-stats {
            margin-bottom: 20px;
        }

        .stat-bar {
            margin: 10px 0;
        }

        .stat-label {
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #666;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .hp-bar { background: #e74c3c; }
        .mp-bar { background: #3498db; }
        .exp-bar { background: #f39c12; }

        .character-image {
            text-align: center;
            margin: 20px 0;
        }

        .character-image img {
            max-width: 150px;
            max-height: 150px;
            border-radius: 10px;
            border: 2px solid #ffd700;
        }

        .story-content {
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #666;
        }

        .story-text {
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .choices {
            display: grid;
            gap: 10px;
        }

        .choice-btn {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            border: 2px solid #3498db;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            text-align: left;
        }

        .choice-btn:hover {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            border-color: #ffd700;
            transform: translateY(-2px);
        }

        .shop-container, .inn-container, .inventory-container, .map-container {
            display: none;
        }

        .shop-container.active, .inn-container.active, .inventory-container.active, .map-container.active {
            display: block;
        }

        .shop-items, .inventory-items {
            display: grid;
            gap: 10px;
            margin: 20px 0;
        }

        .item {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #666;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: bold;
            color: #ffd700;
        }

        .item-description {
            font-size: 0.9em;
            color: #ccc;
            margin: 5px 0;
        }

        .item-price {
            color: #f39c12;
            font-weight: bold;
        }

        .buy-btn, .sell-btn, .use-btn, .equip-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .buy-btn:hover, .sell-btn:hover, .use-btn:hover, .equip-btn:hover {
            background: #2ecc71;
        }

        .buy-btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }

        .game-log {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #666;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #3498db;
            padding-left: 10px;
        }

        .back-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }

        .back-btn:hover {
            background: #c0392b;
        }

        .inn-service {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .rest-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 10px;
        }

        .rest-btn:hover {
            background: #8e44ad;
        }

        .rest-btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }

        .npc-dialogue {
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #f39c12;
        }

        .npc-name {
            color: #f39c12;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .dialogue-text {
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .map-grid {
            display: grid;
            grid-template-columns: repeat(10, 40px);
            gap: 2px;
            margin: 20px 0;
            justify-content: center;
        }

        .map-cell {
            width: 40px;
            height: 40px;
            border: 1px solid #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            cursor: pointer;
            border-radius: 3px;
        }

        .map-cell.player {
            background: #e74c3c;
            border-color: #ffd700;
        }

        .map-cell.forest {
            background: #27ae60;
        }

        .map-cell.town {
            background: #3498db;
        }

        .map-cell.mountain {
            background: #95a5a6;
        }

        .companion-info {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #3498db;
        }

        .companion-name {
            color: #3498db;
            font-weight: bold;
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .game-layout {
                grid-template-columns: 1fr;
            }
            
            .game-title {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="game-title">ğŸ§™â€â™‚ï¸ Anoma RPG - æ„å›¾ä¹‹å¢ƒ ğŸŒŸ</h1>
        
        <div class="game-layout">
            <!-- ä¾§è¾¹æ  - è§’è‰²çŠ¶æ€ -->
            <div class="sidebar">
                <div class="player-stats">
                    <h3>ğŸ§™â€â™‚ï¸ æ„å›¾æ³•å¸ˆ</h3>
                    <p>ç­‰çº§: <span id="player-level">1</span></p>
                    <p>é‡‘å¸: <span id="player-gold">100</span> ğŸ’°</p>
                    
                    <div class="stat-bar">
                        <div class="stat-label">ç”Ÿå‘½å€¼: <span id="hp-text">100/100</span></div>
                        <div class="progress-bar">
                            <div class="progress-fill hp-bar" id="hp-bar" style="width: 100%;"></div>
                        </div>
                    </div>
                    
                    <div class="stat-bar">
                        <div class="stat-label">é­”æ³•å€¼: <span id="mp-text">50/50</span></div>
                        <div class="progress-bar">
                            <div class="progress-fill mp-bar" id="mp-bar" style="width: 100%;"></div>
                        </div>
                    </div>
                    
                    <div class="stat-bar">
                        <div class="stat-label">ç»éªŒå€¼: <span id="exp-text">0/100</span></div>
                        <div class="progress-bar">
                            <div class="progress-fill exp-bar" id="exp-bar" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>

                <div class="character-image">
                    <img id="character-img" src="./wizard.png" alt="è§’è‰²å›¾åƒ">
                </div>

                <!-- ä¼™ä¼´ä¿¡æ¯ -->
                <div id="companion-section" style="display: none;">
                    <div class="companion-info">
                        <div class="companion-name" id="companion-name">è™¾è™¾</div>
                        <div class="stat-bar">
                            <div class="stat-label">ç”Ÿå‘½å€¼: <span id="companion-hp-text">60/60</span></div>
                            <div class="progress-bar">
                                <div class="progress-fill hp-bar" id="companion-hp-bar" style="width: 100%;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å¿«æ·æ“ä½œ -->
                <div style="margin-top: 20px;">
                    <button class="choice-btn" onclick="saveGame()" style="width: 100%; margin-bottom: 10px;">ğŸ’¾ ä¿å­˜æ¸¸æˆ</button>
                    <button class="choice-btn" onclick="loadGame()" style="width: 100%;">ğŸ“ åŠ è½½æ¸¸æˆ</button>
                </div>
            </div>

            <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
            <div class="main-content">
                <!-- æ•…äº‹æ¨¡å¼ -->
                <div id="story-mode">
                    <div class="story-content">
                        <div class="story-text" id="story-text">
                            åœ¨Anomaçš„ç¥ç§˜ä¸–ç•Œä¸­ï¼Œä½ æ˜¯ä¸€ååˆšåˆšè§‰é†’æ„å›¾èƒ½åŠ›çš„å¹´è½»æ³•å¸ˆã€‚è¿™ä¸ªä¸–ç•Œç”±æ— æ•°ä¸ª"æ„å›¾"æ„æˆï¼Œæ¯ä¸ªæ„å›¾éƒ½æ˜¯ç°å®çš„ä¸€ä¸ªç‰‡æ®µï¼Œè€Œä½ æ‹¥æœ‰æ“æ§è¿™äº›æ„å›¾çš„å¤©èµ‹ã€‚

                            ä½ ç«™åœ¨æ–°æ‰‹æ‘çš„ä¸­å¤®ï¼Œå‘¨å›´æ˜¯ç†Ÿæ‚‰çš„èŒ…è‰å±‹å’ŒçŸ³æ¿è·¯ã€‚è¿œå¤„çš„åœ°å¹³çº¿ä¸Šï¼Œç¥ç§˜çš„æ„å›¾ä¹‹å¡”è‹¥éšè‹¥ç°ï¼Œé‚£é‡Œæ®è¯´éšè—ç€Anomaä¸–ç•Œçš„ç»ˆæç§˜å¯†ã€‚

                            ä½ çš„å¯¼å¸ˆå‘Šè¯‰ä½ ï¼Œåªæœ‰é€šè¿‡ä¸æ–­çš„å†’é™©å’Œæˆ˜æ–—ï¼Œæ‰èƒ½æå‡ä½ çš„æ„å›¾æ“æ§èƒ½åŠ›ï¼Œæœ€ç»ˆæˆä¸ºçœŸæ­£çš„æ„å›¾å¤§å¸ˆã€‚
                        </div>
                        
                        <div class="choices" id="story-choices">
                            <button class="choice-btn" onclick="goToVillageChief()">ğŸ  å‰å¾€æ‘é•¿å®¶æ¥å—ç¬¬ä¸€ä¸ªä»»åŠ¡</button>
                            <button class="choice-btn" onclick="exploreForest()">ğŸŒ² æ¢ç´¢æ‘åº„å‘¨å›´çš„æ£®æ—</button>
                            <button class="choice-btn" onclick="openInventory()">ğŸ“Š æŸ¥çœ‹ä¸ªäººçŠ¶æ€å’Œè£…å¤‡</button>
                            <button class="choice-btn" onclick="openShop()">ğŸª å‰å¾€å•†åº—è´­ä¹°ç‰©å“</button>
                            <button class="choice-btn" onclick="openMap()">ğŸ—ºï¸ æ‰“å¼€ä¸–ç•Œåœ°å›¾</button>
                        </div>
                    </div>
                </div>

                <!-- å•†åº—æ¨¡å¼ -->
                <div id="shop-mode" class="shop-container">
                    <h2>ğŸª æ„å›¾å•†åº—</h2>
                    <p>æ¬¢è¿æ¥åˆ°æ„å›¾å•†åº—ï¼è¿™é‡Œæœ‰å„ç§å†’é™©å¿…éœ€å“ã€‚</p>
                    
                    <div class="npc-dialogue">
                        <div class="npc-name">å•†äººé²å‹ƒ</div>
                        <div class="dialogue-text">
                            "æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„å°é•‡ï¼è¿™é‡Œçš„è´¸æ˜“å¾ˆç¹è£ã€‚å¦‚æœä½ éœ€è¦å¥½è£…å¤‡ï¼Œè®°å¾—å»å•†åº—çœ‹çœ‹ï¼æ„å›¾æ³•å¸ˆä»¬æ€»æ˜¯å¾ˆå¿™ç¢Œï¼Œä½†è®°å¾—è¦å¥½å¥½ä¼‘æ¯å“¦ã€‚"
                        </div>
                    </div>
                    
                    <div class="shop-items" id="shop-items">
                        <!-- å•†åº—ç‰©å“å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    
                    <button class="back-btn" onclick="backToStory()">è¿”å›æ‘åº„</button>
                </div>

                <!-- æ—…åº—æ¨¡å¼ -->
                <div id="inn-mode" class="inn-container">
                    <h2>ğŸ¨ æ„å›¾æ—…åº—</h2>
                    
                    <div class="npc-dialogue">
                        <div class="npc-name">å®¢æ ˆè€æ¿å¨˜ç›ä¸½</div>
                        <div class="dialogue-text" id="inn-dialogue">
                            "æ¬¢è¿æ¥åˆ°æ„å›¾æ—…åº—ï¼ç´¯äº†å—ï¼Ÿåœ¨è¿™é‡Œä¼‘æ¯ä¸€ä¸‹ï¼Œåªéœ€è¦20é‡‘å¸å°±èƒ½å®Œå…¨æ¢å¤ä½ çš„ç”Ÿå‘½å€¼å’Œé­”æ³•å€¼ã€‚æˆ‘ä»¬çš„åºŠé“ºæ˜¯å…¨æ‘æœ€èˆ’æœçš„ï¼"
                        </div>
                    </div>
                    
                    <div class="inn-service">
                        <h3>ğŸ’¤ ä¼‘æ¯æœåŠ¡</h3>
                        <p>è´¹ç”¨: 20 é‡‘å¸</p>
                        <p>æ•ˆæœ: å®Œå…¨æ¢å¤ç”Ÿå‘½å€¼å’Œé­”æ³•å€¼</p>
                        <button class="rest-btn" id="rest-btn" onclick="restAtInn()">ğŸ’¤ ä¼‘æ¯ (20é‡‘å¸)</button>
                    </div>
                    
                    <button class="back-btn" onclick="backToStory()">ç¦»å¼€æ—…åº—</button>
                </div>

                <!-- èƒŒåŒ…æ¨¡å¼ -->
                <div id="inventory-mode" class="inventory-container">
                    <h2>ğŸ’ ç‰©å“èƒŒåŒ…</h2>
                    
                    <div class="inventory-items" id="inventory-items">
                        <!-- èƒŒåŒ…ç‰©å“å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    
                    <button class="back-btn" onclick="backToStory()">å…³é—­èƒŒåŒ…</button>
                </div>

                <!-- åœ°å›¾æ¨¡å¼ -->
                <div id="map-mode" class="map-container">
                    <h2>ğŸ—ºï¸ æ„å›¾ä¸–ç•Œåœ°å›¾</h2>
                    <p>ä½¿ç”¨æ–¹å‘é”®æˆ–ç‚¹å‡»ç§»åŠ¨ã€‚ğŸ§™â€â™‚ï¸ è¡¨ç¤ºä½ çš„ä½ç½®ã€‚</p>
                    
                    <div class="map-grid" id="map-grid">
                        <!-- åœ°å›¾å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <button class="choice-btn" onclick="movePlayer(-1, 0)" style="width: 60px;">â¬…ï¸</button>
                        <button class="choice-btn" onclick="movePlayer(1, 0)" style="width: 60px;">â¡ï¸</button>
                        <button class="choice-btn" onclick="movePlayer(0, -1)" style="width: 60px;">â¬†ï¸</button>
                        <button class="choice-btn" onclick="movePlayer(0, 1)" style="width: 60px;">â¬‡ï¸</button>
                    </div>
                    
                    <button class="back-btn" onclick="backToStory()">å…³é—­åœ°å›¾</button>
                </div>

                <!-- æ¸¸æˆæ—¥å¿— -->
                <div class="game-log">
                    <h4>ğŸ“œ æ¸¸æˆæ—¥å¿—</h4>
                    <div id="game-log">
                        <div class="log-entry">æ¸¸æˆå¼€å§‹ï¼æ¬¢è¿æ¥åˆ°Anomaä¸–ç•Œï¼</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            player: {
                level: 1,
                hp: 100,
                maxHp: 100,
                mp: 50,
                maxMp: 50,
                exp: 0,
                maxExp: 100,
                gold: 100,
                x: 5,
                y: 5,
                inventory: [
                    { id: 'potion', name: 'æ²»ç–—è¯æ°´', type: 'consumable', effect: { hp: 30 }, price: 50, description: 'æ¢å¤30ç‚¹ç”Ÿå‘½å€¼' },
                    { id: 'mana_potion', name: 'é­”æ³•è¯æ°´', type: 'consumable', effect: { mp: 20 }, price: 40, description: 'æ¢å¤20ç‚¹é­”æ³•å€¼' }
                ],
                equipment: {
                    weapon: { id: 'starter_staff', name: 'æ–°æ‰‹æ³•æ–', attack: 10 },
                    armor: { id: 'cloth_robe', name: 'å¸ƒåˆ¶é•¿è¢', defense: 5 }
                },
                companions: []
            },
            currentScene: 'intro',
            gameMode: 'story',
            hasCompanion: false,
            gameMap: null
        };

        // å•†åº—ç‰©å“
        const shopItems = [
            { id: 'healing_potion', name: 'æ²»ç–—è¯æ°´', type: 'consumable', effect: { hp: 30 }, price: 50, description: 'æ¢å¤30ç‚¹ç”Ÿå‘½å€¼' },
            { id: 'mana_potion', name: 'é­”æ³•è¯æ°´', type: 'consumable', effect: { mp: 20 }, price: 40, description: 'æ¢å¤20ç‚¹é­”æ³•å€¼' },
            { id: 'iron_sword', name: 'é“å‰‘', type: 'weapon', attack: 20, price: 100, description: 'æ”»å‡»åŠ›+20çš„é“åˆ¶æ­¦å™¨' },
            { id: 'leather_armor', name: 'çš®ç”²', type: 'armor', defense: 10, price: 80, description: 'é˜²å¾¡åŠ›+10çš„çš®åˆ¶æŠ¤ç”²' },
            { id: 'magic_ring', name: 'é­”æ³•æˆ’æŒ‡', type: 'accessory', mp: 20, price: 150, description: 'å¢åŠ 20ç‚¹æœ€å¤§é­”æ³•å€¼' },
            { id: 'strength_potion', name: 'åŠ›é‡è¯æ°´', type: 'consumable', effect: { attack: 10 }, price: 50, description: 'ä¸´æ—¶å¢åŠ 10ç‚¹æ”»å‡»åŠ›' }
        ];

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            updateUI();
            generateMap();
            addLog('æ¸¸æˆåˆå§‹åŒ–å®Œæˆï¼');
        }

        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('player-level').textContent = gameState.player.level;
            document.getElementById('player-gold').textContent = gameState.player.gold;
            
            // æ›´æ–°è¡€æ¡
            const hpPercent = (gameState.player.hp / gameState.player.maxHp) * 100;
            document.getElementById('hp-bar').style.width = hpPercent + '%';
            document.getElementById('hp-text').textContent = `${gameState.player.hp}/${gameState.player.maxHp}`;
            
            // æ›´æ–°é­”æ³•æ¡
            const mpPercent = (gameState.player.mp / gameState.player.maxMp) * 100;
            document.getElementById('mp-bar').style.width = mpPercent + '%';
            document.getElementById('mp-text').textContent = `${gameState.player.mp}/${gameState.player.maxMp}`;
            
            // æ›´æ–°ç»éªŒæ¡
            const expPercent = (gameState.player.exp / gameState.player.maxExp) * 100;
            document.getElementById('exp-bar').style.width = expPercent + '%';
            document.getElementById('exp-text').textContent = `${gameState.player.exp}/${gameState.player.maxExp}`;

            // æ›´æ–°ä¼™ä¼´ä¿¡æ¯
            if (gameState.hasCompanion) {
                document.getElementById('companion-section').style.display = 'block';
                document.getElementById('character-img').src="./monster1.png"';
            }
        }

        // æ·»åŠ æ—¥å¿—
        function addLog(message) {
            const logDiv = document.getElementById('game-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = message;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // åˆ‡æ¢æ¸¸æˆæ¨¡å¼
        function switchMode(mode) {
            // éšè—æ‰€æœ‰æ¨¡å¼
            document.getElementById('story-mode').style.display = 'none';
            document.getElementById('shop-mode').style.display = 'none';
            document.getElementById('inn-mode').style.display = 'none';
            document.getElementById('inventory-mode').style.display = 'none';
            document.getElementById('map-mode').style.display = 'none';
            
            // æ˜¾ç¤ºæŒ‡å®šæ¨¡å¼
            document.getElementById(mode + '-mode').style.display = 'block';
            gameState.gameMode = mode;
        }

        // æ•…äº‹é€‰æ‹©å‡½æ•°
        function goToVillageChief() {
            document.getElementById('story-text').innerHTML = `
                æ‘é•¿æ˜¯ä¸€ä½æ…ˆç¥¥çš„è€äººï¼Œä»–çš„çœ¼ä¸­é—ªçƒç€æ™ºæ…§çš„å…‰èŠ’ã€‚å½“ä½ èµ°è¿›ä»–çš„æˆ¿é—´æ—¶ï¼Œä»–æ­£åœ¨ç ”ç©¶ä¸€å¼ å¤è€çš„åœ°å›¾ã€‚
                <br><br>
                "å¹´è½»çš„æ„å›¾æ³•å¸ˆï¼Œ"æ‘é•¿æŠ¬èµ·å¤´çœ‹ç€ä½ ï¼Œ"æˆ‘ä»¬æ‘åº„æœ€è¿‘é‡åˆ°äº†éº»çƒ¦ã€‚æ£®æ—æ·±å¤„å‡ºç°äº†ä¸€äº›å¥‡æ€ªçš„ç”Ÿç‰©ï¼Œå®ƒä»¬ä¼¼ä¹è¢«æŸç§æ‰­æ›²çš„æ„å›¾æ‰€é©±åŠ¨ã€‚
                <br><br>
                æˆ‘éœ€è¦ä½ å»è°ƒæŸ¥è¿™ä»¶äº‹ï¼Œä½†é¦–å…ˆï¼Œä½ éœ€è¦ä¸€ä¸ªä¼™ä¼´ã€‚åœ¨æ‘åº„çš„ä¸œè¾¹ï¼Œæœ‰ä¸€åªåå«è™¾è™¾çš„ç¥å¥‡ç”Ÿç‰©ï¼Œå®ƒä¸€ç›´åœ¨ç­‰å¾…åˆé€‚çš„æ„å›¾æ³•å¸ˆã€‚"
            `;
            
            document.getElementById('story-choices').innerHTML = `
                <button class="choice-btn" onclick="findCompanion()">ğŸ¦ æ¥å—ä»»åŠ¡ï¼Œå‰å¾€å¯»æ‰¾è™¾è™¾</button>
                <button class="choice-btn" onclick="openInn()">ğŸ¨ å…ˆå»æ—…åº—ä¼‘æ¯ä¸€ä¸‹</button>
                <button class="choice-btn" onclick="openShop()">ğŸª å‰å¾€å•†åº—è´­ä¹°è£…å¤‡</button>
                <button class="choice-btn" onclick="backToVillage()">ğŸ  è¿”å›æ‘åº„ä¸­å¿ƒ</button>
            `;
            
            addLog('ä½ å‰å¾€æ‘é•¿å®¶æ¥å—äº†ä»»åŠ¡');
        }

        function findCompanion() {
            gameState.hasCompanion = true;
            document.getElementById('story-text').innerHTML = `
                ä½ æ¥åˆ°æ‘åº„ä¸œè¾¹çš„å°æºªæ—ï¼Œè¿™é‡Œæ°´è‰ä¸°èŒ‚ï¼Œé˜³å…‰é€è¿‡æ ‘å¶æ´’åœ¨æ°´é¢ä¸Šã€‚çªç„¶ï¼Œä¸€ä¸ªçº¢è‰²çš„èº«å½±ä»æ°´ä¸­è·ƒå‡ºï¼
                <br><br>
                è¿™å°±æ˜¯è™¾è™¾â€”â€”ä¸€åªæˆ´ç€è“è‰²å¸½å­çš„ç¥å¥‡è™¾ç±»ç”Ÿç‰©ã€‚å®ƒçš„çœ¼ä¸­é—ªçƒç€ç”µå…‰ï¼Œä¼¼ä¹æ‹¥æœ‰æŸç§ç‰¹æ®Šçš„èƒ½åŠ›ã€‚
                <br><br>
                è™¾è™¾çœ‹åˆ°ä½ åï¼Œå…´å¥‹åœ°æ¸¸åˆ°å²¸è¾¹ï¼Œç”¨å®ƒç‹¬ç‰¹çš„æ–¹å¼ä¸ä½ äº¤æµã€‚ä½ æ„Ÿå—åˆ°äº†ä¸€ç§å¥‡å¦™çš„æ„å›¾å…±é¸£ã€‚
                <br><br>
                <strong>è™¾è™¾åŠ å…¥äº†ä½ çš„é˜Ÿä¼ï¼</strong>
            `;
            
            document.getElementById('story-choices').innerHTML = `
                <button class="choice-btn" onclick="exploreForest()">ğŸŒ² ä¸è™¾è™¾ä¸€èµ·æ¢ç´¢æ£®æ—</button>
                <button class="choice-btn" onclick="openShop()">ğŸª å…ˆå»å•†åº—è´­ä¹°è£…å¤‡</button>
                <button class="choice-btn" onclick="openInn()">ğŸ¨ å»æ—…åº—åº†ç¥ä¸€ä¸‹</button>
                <button class="choice-btn" onclick="backToVillage()">ğŸ  è¿”å›æ‘åº„ä¸­å¿ƒ</button>
            `;
            
            updateUI();
            addLog('è™¾è™¾åŠ å…¥äº†ä½ çš„é˜Ÿä¼ï¼');
        }

        function exploreForest() {
            document.getElementById('story-text').innerHTML = `
                ä½ ${gameState.hasCompanion ? 'å’Œè™¾è™¾ä¸€èµ·' : ''}æ¥åˆ°äº†æ‘åº„å¤–çš„æ£®æ—è¾¹ç¼˜ã€‚è¿™é‡Œçš„æ ‘æœ¨å¼‚å¸¸é«˜å¤§ï¼Œæå¶èŒ‚å¯†å¾—å‡ ä¹é®è”½äº†å¤©ç©ºã€‚
                <br><br>
                ç©ºæ°”ä¸­å¼¥æ¼«ç€ä¸€ç§å¥‡ç‰¹çš„èƒ½é‡æ³¢åŠ¨ï¼Œä½ çš„æ„å›¾æ„ŸçŸ¥å‘Šè¯‰ä½ ï¼Œè¿™é‡Œéšè—ç€è®¸å¤šç§˜å¯†ã€‚
                <br><br>
                è¿œå¤„ä¼ æ¥äº†å¥‡æ€ªçš„å£°éŸ³ï¼Œä¼¼ä¹æ˜¯æŸç§ç”Ÿç‰©åœ¨ç§»åŠ¨ã€‚ä½ éœ€è¦å°å¿ƒè¡Œäº‹ã€‚
            `;
            
            document.getElementById('story-choices').innerHTML = `
                <button class="choice-btn" onclick="encounterBattle()">âš”ï¸ æ·±å…¥æ£®æ—æ¢ç´¢</button>
                <button class="choice-btn" onclick="findTreasure()">ğŸ’ æœç´¢éšè—çš„å®è—</button>
                <button class="choice-btn" onclick="openMap()">ğŸ—ºï¸ æŸ¥çœ‹åœ°å›¾è§„åˆ’è·¯çº¿</button>
                <button class="choice-btn" onclick="backToVillage()">ğŸ  è¿”å›æ‘åº„</button>
            `;
            
            addLog('ä½ è¿›å…¥äº†ç¥ç§˜çš„æ£®æ—');
        }

        function encounterBattle() {
            const damage = Math.floor(Math.random() * 20) + 10;
            const expGain = Math.floor(Math.random() * 30) + 20;
            const goldGain = Math.floor(Math.random() * 50) + 25;
            
            gameState.player.hp = Math.max(0, gameState.player.hp - damage);
            gameState.player.exp += expGain;
            gameState.player.gold += goldGain;
            
            // æ£€æŸ¥å‡çº§
            if (gameState.player.exp >= gameState.player.maxExp) {
                gameState.player.level++;
                gameState.player.exp = 0;
                gameState.player.maxExp += 50;
                gameState.player.maxHp += 20;
                gameState.player.hp = gameState.player.maxHp;
                gameState.player.maxMp += 10;
                gameState.player.mp = gameState.player.maxMp;
                addLog(`æ­å–œï¼ä½ å‡åˆ°äº†${gameState.player.level}çº§ï¼`);
            }
            
            document.getElementById('story-text').innerHTML = `
                ä½ åœ¨æ£®æ—æ·±å¤„é‡åˆ°äº†ä¸€åªè¢«æ‰­æ›²æ„å›¾å½±å“çš„æ£®æ—ç”Ÿç‰©ï¼
                <br><br>
                ç»è¿‡ä¸€ç•ªæ¿€çƒˆçš„æˆ˜æ–—ï¼Œä½ ${gameState.hasCompanion ? 'å’Œè™¾è™¾' : ''}æˆåŠŸå‡»è´¥äº†å®ƒã€‚è™½ç„¶å—äº†ä¸€äº›ä¼¤ï¼ˆ-${damage} HPï¼‰ï¼Œä½†ä½ è·å¾—äº†å®è´µçš„ç»éªŒã€‚
                <br><br>
                <strong>æˆ˜æ–—ç»“æœï¼š</strong><br>
                â€¢ å—åˆ°ä¼¤å®³ï¼š${damage} HP<br>
                â€¢ è·å¾—ç»éªŒï¼š${expGain} EXP<br>
                â€¢ è·å¾—é‡‘å¸ï¼š${goldGain} ğŸ’°
            `;
            
            document.getElementById('story-choices').innerHTML = `
                <button class="choice-btn" onclick="openInn()">ğŸ¨ å»æ—…åº—æ²»ç–—ä¼¤åŠ¿</button>
                <button class="choice-btn" onclick="usePotion()">ğŸ§ª ä½¿ç”¨æ²»ç–—è¯æ°´</button>
                <button class="choice-btn" onclick="exploreForest()">ğŸŒ² ç»§ç»­æ¢ç´¢æ£®æ—</button>
                <button class="choice-btn" onclick="backToVillage()">ğŸ  è¿”å›æ‘åº„</button>
            `;
            
            updateUI();
            addLog(`æˆ˜æ–—èƒœåˆ©ï¼è·å¾—${expGain}ç»éªŒå’Œ${goldGain}é‡‘å¸`);
        }

        function findTreasure() {
            const goldFound = Math.floor(Math.random() * 100) + 50;
            gameState.player.gold += goldFound;
            
            // éšæœºè·å¾—ç‰©å“
            const treasureItems = [
                { id: 'rare_potion', name: 'ç¨€æœ‰æ²»ç–—è¯æ°´', type: 'consumable', effect: { hp: 80 }, price: 120, description: 'æ¢å¤80ç‚¹ç”Ÿå‘½å€¼çš„çè´µè¯æ°´' },
                { id: 'magic_crystal', name: 'é­”æ³•æ°´æ™¶', type: 'consumable', effect: { mp: 50 }, price: 100, description: 'è•´å«çº¯å‡€é­”æ³•èƒ½é‡çš„æ°´æ™¶' }
            ];
            
            const foundItem = treasureItems[Math.floor(Math.random() * treasureItems.length)];
            gameState.player.inventory.push(foundItem);
            
            document.getElementById('story-text').innerHTML = `
                åœ¨æ£®æ—çš„ä¸€ä¸ªéšç§˜è§’è½ï¼Œä½ å‘ç°äº†ä¸€ä¸ªå¤è€çš„å®ç®±ï¼
                <br><br>
                å®ç®±æ•£å‘ç€å¾®å¼±çš„æ„å›¾å…‰èŠ’ï¼Œæ˜¾ç„¶æ˜¯è¢«æŸç§é­”æ³•ä¿æŠ¤ç€çš„ã€‚å½“ä½ å°å¿ƒç¿¼ç¿¼åœ°æ‰“å¼€å®ƒæ—¶ï¼Œé‡Œé¢çš„å®ç‰©è®©ä½ çœ¼å‰ä¸€äº®ï¼
                <br><br>
                <strong>å‘ç°å®è—ï¼š</strong><br>
                â€¢ é‡‘å¸ï¼š${goldFound} ğŸ’°<br>
                â€¢ ç‰©å“ï¼š${foundItem.name}
            `;
            
            document.getElementById('story-choices').innerHTML = `
                <button class="choice-btn" onclick="exploreForest()">ğŸŒ² ç»§ç»­æ¢ç´¢æ£®æ—</button>
                <button class="choice-btn" onclick="openInventory()">ğŸ’ æŸ¥çœ‹è·å¾—çš„ç‰©å“</button>
                <button class="choice-btn" onclick="backToVillage()">ğŸ  è¿”å›æ‘åº„</button>
                <button class="choice-btn" onclick="openShop()">ğŸª å»å•†åº—å‡ºå”®ç‰©å“</button>
            `;
            
            updateUI();
            addLog(`å‘ç°å®è—ï¼è·å¾—${goldFound}é‡‘å¸å’Œ${foundItem.name}`);
        }

        function usePotion() {
            const potionIndex = gameState.player.inventory.findIndex(item => item.type === 'consumable' && item.effect.hp);
            if (potionIndex !== -1) {
                const potion = gameState.player.inventory[potionIndex];
                gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + potion.effect.hp);
                gameState.player.inventory.splice(potionIndex, 1);
                addLog(`ä½¿ç”¨äº†${potion.name}ï¼Œæ¢å¤äº†${potion.effect.hp}ç‚¹ç”Ÿå‘½å€¼`);
                updateUI();
                exploreForest();
            } else {
                addLog('ä½ æ²¡æœ‰æ²»ç–—è¯æ°´ï¼');
                exploreForest();
            }
        }

        function backToVillage() {
            document.getElementById('story-text').innerHTML = `
                ä½ å›åˆ°äº†ç†Ÿæ‚‰çš„æ–°æ‰‹æ‘ã€‚æ‘åº„é‡Œçš„äººä»¬æ­£åœ¨å¿™ç¢Œç€å„è‡ªçš„äº‹æƒ…ï¼Œç©ºæ°”ä¸­å¼¥æ¼«ç€ç‚ŠçƒŸçš„é¦™å‘³ã€‚
                <br><br>
                ${gameState.hasCompanion ? 'è™¾è™¾åœ¨ä½ èº«è¾¹æ¸¸æ¥æ¸¸å»ï¼Œä¼¼ä¹å¯¹è¿™ä¸ªåœ°æ–¹å¾ˆæ„Ÿå…´è¶£ã€‚' : ''}
                <br><br>
                ä½ å¯ä»¥é€‰æ‹©æ¥ä¸‹æ¥è¦åšä»€ä¹ˆã€‚
            `;
            
            document.getElementById('story-choices').innerHTML = `
                <button class="choice-btn" onclick="goToVillageChief()">ğŸ  å‰å¾€æ‘é•¿å®¶æ¥å—ä»»åŠ¡</button>
                <button class="choice-btn" onclick="exploreForest()">ğŸŒ² æ¢ç´¢æ‘åº„å‘¨å›´çš„æ£®æ—</button>
                <button class="choice-btn" onclick="openInventory()">ğŸ“Š æŸ¥çœ‹ä¸ªäººçŠ¶æ€å’Œè£…å¤‡</button>
                <button class="choice-btn" onclick="openShop()">ğŸª å‰å¾€å•†åº—è´­ä¹°ç‰©å“</button>
                <button class="choice-btn" onclick="openMap()">ğŸ—ºï¸ æ‰“å¼€ä¸–ç•Œåœ°å›¾</button>
            `;
            
            addLog('ä½ å›åˆ°äº†æ‘åº„ä¸­å¿ƒ');
        }

        // å•†åº—åŠŸèƒ½
        function openShop() {
            switchMode('shop');
            renderShop();
            addLog('ä½ è¿›å…¥äº†å•†åº—');
        }

        function renderShop() {
            const shopContainer = document.getElementById('shop-items');
            shopContainer.innerHTML = '';
            
            shopItems.forEach(item => {
                const canAfford = gameState.player.gold >= item.price;
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item';
                itemDiv.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-description">${item.description}</div>
                        <div class="item-price">ä»·æ ¼: ${item.price} é‡‘å¸</div>
                    </div>
                    <button class="buy-btn" onclick="buyItem('${item.id}')" ${!canAfford ? 'disabled' : ''}>
                        ${canAfford ? 'è´­ä¹°' : 'é‡‘å¸ä¸è¶³'}
                    </button>
                `;
                shopContainer.appendChild(itemDiv);
            });
        }

        function buyItem(itemId) {
            const item = shopItems.find(i => i.id === itemId);
            if (item && gameState.player.gold >= item.price) {
                gameState.player.gold -= item.price;
                gameState.player.inventory.push({...item});
                addLog(`è´­ä¹°äº†${item.name}ï¼ŒèŠ±è´¹${item.price}é‡‘å¸`);
                updateUI();
                renderShop();
            }
        }

        // æ—…åº—åŠŸèƒ½
        function openInn() {
            switchMode('inn');
            updateRestButton();
            addLog('ä½ è¿›å…¥äº†æ—…åº—');
        }

        function updateRestButton() {
            const restBtn = document.getElementById('rest-btn');
            const canAfford = gameState.player.gold >= 20;
            const needsRest = gameState.player.hp < gameState.player.maxHp || gameState.player.mp < gameState.player.maxMp;
            
            restBtn.disabled = !canAfford || !needsRest;
            
            if (!needsRest) {
                restBtn.textContent = 'ğŸ’¤ ä½ å·²ç»å®Œå…¨æ¢å¤äº†';
            } else if (!canAfford) {
                restBtn.textContent = 'ğŸ’¤ é‡‘å¸ä¸è¶³ (éœ€è¦20é‡‘å¸)';
            } else {
                restBtn.textContent = 'ğŸ’¤ ä¼‘æ¯ (20é‡‘å¸)';
            }
        }

        function restAtInn() {
            if (gameState.player.gold >= 20) {
                gameState.player.gold -= 20;
                gameState.player.hp = gameState.player.maxHp;
                gameState.player.mp = gameState.player.maxMp;
                
                document.getElementById('inn-dialogue').innerHTML = `
                    "å¥½å¥½ä¼‘æ¯å§ï¼"ç›ä¸½æ¸©å’Œåœ°è¯´é“ã€‚ä½ åœ¨èˆ’é€‚çš„åºŠé“ºä¸Šç¡äº†ä¸€è§‰ï¼Œæ„Ÿè§‰ç²¾ç¥ç„•å‘ï¼
                    <br><br>
                    <strong>ä½ çš„ç”Ÿå‘½å€¼å’Œé­”æ³•å€¼å·²å®Œå…¨æ¢å¤ï¼</strong>
                `;
                
                addLog('åœ¨æ—…åº—ä¼‘æ¯ï¼Œå®Œå…¨æ¢å¤äº†ç”Ÿå‘½å€¼å’Œé­”æ³•å€¼');
                updateUI();
                updateRestButton();
            }
        }

        // èƒŒåŒ…åŠŸèƒ½
        function openInventory() {
            switchMode('inventory');
            renderInventory();
            addLog('ä½ æ‰“å¼€äº†èƒŒåŒ…');
        }

        function renderInventory() {
            const inventoryContainer = document.getElementById('inventory-items');
            inventoryContainer.innerHTML = '';
            
            if (gameState.player.inventory.length === 0) {
                inventoryContainer.innerHTML = '<p>èƒŒåŒ…æ˜¯ç©ºçš„</p>';
                return;
            }
            
            gameState.player.inventory.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item';
                
                let actionButton = '';
                if (item.type === 'consumable') {
                    actionButton = `<button class="use-btn" onclick="useInventoryItem(${index})">ä½¿ç”¨</button>`;
                } else {
                    actionButton = `<button class="equip-btn" onclick="equipItem(${index})">è£…å¤‡</button>`;
                }
                
                itemDiv.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-description">${item.description}</div>
                        <div class="item-price">ä»·å€¼: ${item.price} é‡‘å¸</div>
                    </div>
                    <div>
                        ${actionButton}
                        <button class="sell-btn" onclick="sellItem(${index})">å‡ºå”®</button>
                    </div>
                `;
                inventoryContainer.appendChild(itemDiv);
            });
        }

        function useInventoryItem(index) {
            const item = gameState.player.inventory[index];
            if (item.type === 'consumable') {
                if (item.effect.hp) {
                    gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + item.effect.hp);
                    addLog(`ä½¿ç”¨äº†${item.name}ï¼Œæ¢å¤äº†${item.effect.hp}ç‚¹ç”Ÿå‘½å€¼`);
                }
                if (item.effect.mp) {
                    gameState.player.mp = Math.min(gameState.player.maxMp, gameState.player.mp + item.effect.mp);
                    addLog(`ä½¿ç”¨äº†${item.name}ï¼Œæ¢å¤äº†${item.effect.mp}ç‚¹é­”æ³•å€¼`);
                }
                
                gameState.player.inventory.splice(index, 1);
                updateUI();
                renderInventory();
            }
        }

        function equipItem(index) {
            const item = gameState.player.inventory[index];
            // ç®€åŒ–çš„è£…å¤‡ç³»ç»Ÿ
            addLog(`è£…å¤‡äº†${item.name}`);
            gameState.player.inventory.splice(index, 1);
            renderInventory();
        }

        function sellItem(index) {
            const item = gameState.player.inventory[index];
            const sellPrice = Math.floor(item.price * 0.7); // 70%çš„ä»·æ ¼å‡ºå”®
            gameState.player.gold += sellPrice;
            gameState.player.inventory.splice(index, 1);
            addLog(`å‡ºå”®äº†${item.name}ï¼Œè·å¾—${sellPrice}é‡‘å¸`);
            updateUI();
            renderInventory();
        }

        // åœ°å›¾åŠŸèƒ½
        function openMap() {
            switchMode('map');
            renderMap();
            addLog('ä½ æ‰“å¼€äº†ä¸–ç•Œåœ°å›¾');
        }

        function generateMap() {
            gameState.gameMap = [];
            for (let y = 0; y < 10; y++) {
                gameState.gameMap[y] = [];
                for (let x = 0; x < 10; x++) {
                    let terrain = 'grass';
                    if (Math.random() < 0.2) terrain = 'forest';
                    else if (Math.random() < 0.1) terrain = 'mountain';
                    else if (Math.random() < 0.05) terrain = 'town';
                    
                    gameState.gameMap[y][x] = {
                        terrain: terrain,
                        discovered: false
                    };
                }
            }
            
            // è®¾ç½®èµ·å§‹ä½ç½®
            gameState.gameMap[gameState.player.y][gameState.player.x] = {
                terrain: 'village',
                discovered: true
            };
        }

        function renderMap() {
            const mapContainer = document.getElementById('map-grid');
            mapContainer.innerHTML = '';
            
            for (let y = 0; y < 10; y++) {
                for (let x = 0; x < 10; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'map-cell';
                    
                    if (x === gameState.player.x && y === gameState.player.y) {
                        cell.textContent = 'ğŸ§™â€â™‚ï¸';
                        cell.classList.add('player');
                    } else if (gameState.gameMap[y][x].discovered) {
                        const terrain = gameState.gameMap[y][x].terrain;
                        switch (terrain) {
                            case 'village': cell.textContent = 'ğŸ˜ï¸'; break;
                            case 'town': cell.textContent = 'ğŸ›ï¸'; cell.classList.add('town'); break;
                            case 'forest': cell.textContent = 'ğŸŒ²'; cell.classList.add('forest'); break;
                            case 'mountain': cell.textContent = 'â›°ï¸'; cell.classList.add('mountain'); break;
                            default: cell.textContent = 'ğŸŒ±'; break;
                        }
                    } else {
                        cell.textContent = 'â“';
                    }
                    
                    cell.onclick = () => movePlayerTo(x, y);
                    mapContainer.appendChild(cell);
                }
            }
        }

        function movePlayer(dx, dy) {
            const newX = Math.max(0, Math.min(9, gameState.player.x + dx));
            const newY = Math.max(0, Math.min(9, gameState.player.y + dy));
            
            if (newX !== gameState.player.x || newY !== gameState.player.y) {
                gameState.player.x = newX;
                gameState.player.y = newY;
                
                // å‘ç°æ–°åŒºåŸŸ
                gameState.gameMap[newY][newX].discovered = true;
                
                // éšæœºäº‹ä»¶
                const terrain = gameState.gameMap[newY][newX].terrain;
                if (terrain === 'forest' && Math.random() < 0.3) {
                    addLog('åœ¨æ£®æ—ä¸­é‡åˆ°äº†é‡ç”ŸåŠ¨ç‰©ï¼');
                } else if (terrain === 'town') {
                    addLog('åˆ°è¾¾äº†ä¸€ä¸ªç¹åçš„åŸé•‡');
                }
                
                renderMap();
                addLog(`ç§»åŠ¨åˆ°ä½ç½® (${newX}, ${newY})`);
            }
        }

        function movePlayerTo(x, y) {
            const distance = Math.abs(x - gameState.player.x) + Math.abs(y - gameState.player.y);
            if (distance === 1) {
                movePlayer(x - gameState.player.x, y - gameState.player.y);
            }
        }

        // è¿”å›æ•…äº‹æ¨¡å¼
        function backToStory() {
            switchMode('story');
            addLog('è¿”å›åˆ°æ•…äº‹æ¨¡å¼');
        }

        // ä¿å­˜å’ŒåŠ è½½æ¸¸æˆ
        function saveGame() {
            localStorage.setItem('anomaRpgSave', JSON.stringify(gameState));
            addLog('æ¸¸æˆå·²ä¿å­˜');
        }

        function loadGame() {
            const saved = localStorage.getItem('anomaRpgSave');
            if (saved) {
                gameState = JSON.parse(saved);
                updateUI();
                addLog('æ¸¸æˆå·²åŠ è½½');
            } else {
                addLog('æ²¡æœ‰æ‰¾åˆ°ä¿å­˜çš„æ¸¸æˆ');
            }
        }

        // é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', function(e) {
            if (gameState.gameMode === 'map') {
                switch(e.key) {
                    case 'ArrowUp':
                    case 'w':
                        e.preventDefault();
                        movePlayer(0, -1);
                        break;
                    case 'ArrowDown':
                    case 's':
                        e.preventDefault();
                        movePlayer(0, 1);
                        break;
                    case 'ArrowLeft':
                    case 'a':
                        e.preventDefault();
                        movePlayer(-1, 0);
                        break;
                    case 'ArrowRight':
                    case 'd':
                        e.preventDefault();
                        movePlayer(1, 0);
                        break;
                }
            }
        });

        // æ¸¸æˆåˆå§‹åŒ–
        window.onload = function() {
            initGame();
        };
    </script>
</body>
</html>

